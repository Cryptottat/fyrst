# FYRST 프로젝트 현황 문서

## 현재 인프라 상태

| 서비스 | URL | 상태 |
|--------|-----|------|
| 프론트엔드 (Vercel) | https://fyrst.fun | 정상 (HTTP 200) |
| 프론트엔드 (www) | https://www.fyrst.fun | CNAME -> cname.vercel-dns.com |
| 백엔드 API (Railway) | https://api.fyrst.fun | SSL 발급 중 (자동 완료 대기) |
| 백엔드 API (기본) | https://fyrst-api-production.up.railway.app | 정상 작동 |
| GitHub | https://github.com/Cryptottat/fyrst | public 리포 |
| DB (PostgreSQL) | Railway 내부 | Prisma 연결 |
| 캐시 (Redis) | Railway 내부 | BullMQ 연결 |

> DNS 레코드 (Hostinger, TTL 60초):
> - A `@` -> `76.76.21.21` (Vercel)
> - CNAME `www` -> `cname.vercel-dns.com` (Vercel)
> - CNAME `api` -> `sk22rfr0.up.railway.app` (Railway)

---

## 후킹 1차 / 2차 전략 -- 환경변수로 제어

### 1차 후킹: 인지/커뮤니티 빌딩

**목적:** 사이트 공개, 커뮤니티 유입, 컨셉 전파. 실제 거래 기능 없음.

**환경변수 세팅 (Vercel):**

```
NEXT_PUBLIC_FEATURE_TRADING=false
NEXT_PUBLIC_FEATURE_WALLET=true
NEXT_PUBLIC_FEATURE_REFUND=false
```

**사용자에게 보이는 것:**
- 랜딩 페이지 (Hero + 3D 금고 애니메이션 + 통계 + HowItWorks + WhyFyrst)
- 대시보드 `/dashboard` -- 토큰 리스트 브라우징 (데모 데이터)
- 배포자 프로필 `/deployer/[address]` -- 평판 점수, 등급 확인
- 토큰 상세 `/token/[mint]` -- 본딩 커브 차트(읽기 전용), 배포자 정보
- 지갑 연결 (Phantom, Solflare 등) -- 연결만 가능, 트랜잭션 없음

**비활성 상태:**
- Buy/Sell 버튼 비활성
- 환불 청구 불가
- `/launch` 페이지 접근 가능하나 실제 토큰 배포 TX 없음

**이 시기에 할 일:**
- 트위터 런칭 쓰레드 게시 (산출물 마케팅 카피 사용)
- 텔레그램 커뮤니티 개설
- "Coming Soon" 분위기로 기대감 조성

---

### 2차 후킹: 풀 런칭

**목적:** 거래 + 환불 시스템 전체 활성화. 실제 SOL 이동.

**환경변수 세팅 (Vercel):**

```
NEXT_PUBLIC_FEATURE_TRADING=true
NEXT_PUBLIC_FEATURE_WALLET=true
NEXT_PUBLIC_FEATURE_REFUND=true
```

**추가 활성화되는 것:**
- `/launch` -- 토큰 배포 폼 (담보 입금 + 토큰 메타데이터)
- Buy/Sell -- 본딩 커브 기반 실거래
- 환불 청구 -- 24시간 내 러그 시 자동 환불 가능
- 포트폴리오 `/portfolio` -- 보유 토큰 + 환불 이력
- WebSocket 실시간 가격 피드

**2차 전에 반드시 완료:**
- Solana devnet 테스트 (Anchor 프로그램 배포)
- 본딩 커브 수치 검증 (base_price, slope 파라미터)
- 에스크로 PDA 동작 확인
- BullMQ 환불 워커 테스트

---

## 환경변수 전체 목록

### Vercel (프론트엔드)

| 변수 | 현재값 | 설명 |
|------|--------|------|
| `NEXT_PUBLIC_API_URL` | `https://api.fyrst.fun` | 백엔드 API 주소 |
| `NEXT_PUBLIC_WS_URL` | `wss://api.fyrst.fun` | WebSocket 주소 |
| `NEXT_PUBLIC_SOLANA_RPC` | QuickNode mainnet URL | Solana RPC 엔드포인트 |
| `NEXT_PUBLIC_SITE_URL` | `https://fyrst.fun` | 사이트 기본 URL |
| `NEXT_PUBLIC_FEATURE_TRADING` | `false` | 거래 기능 on/off |
| `NEXT_PUBLIC_FEATURE_WALLET` | `true` | 지갑 연결 on/off |
| `NEXT_PUBLIC_FEATURE_REFUND` | `false` | 환불 기능 on/off |

> Vercel 환경변수 변경 시 **재배포 필요** (push 또는 Vercel 대시보드에서 Redeploy).

### Railway (백엔드)

| 변수 | 설명 |
|------|------|
| `PORT` | Railway가 자동 할당 |
| `NODE_ENV` | `production` |
| `CORS_ORIGINS` | `https://fyrst.fun` |
| `DATABASE_URL` | Railway PostgreSQL 내부 URL (자동 주입) |
| `REDIS_URL` | Railway Redis 내부 URL (자동 주입) |
| `SOLANA_RPC_URL` | 기본 Solana RPC |
| `QUICKNODE_RPC_URL` | QuickNode 백업 RPC |
| `HELIUS_API_KEY` | Helius DAS API 키 |
| `HELIUS_RPC_URL` | Helius RPC 엔드포인트 |
| `JUPITER_API_URL` | `https://api.jup.ag` (고정) |
| `TELEGRAM_BOT_TOKEN` | 텔레그램 모니터링 봇 토큰 |
| `TELEGRAM_CHAT_ID` | 텔레그램 알림 채널 ID |

---

## 핵심 시스템 설명

### 배포자 담보 에스크로

배포자가 토큰을 런칭하려면 최소 1 SOL을 에스크로에 예치해야 한다.

| 담보 티어 | SOL | 신뢰도 신호 |
|-----------|-----|-------------|
| Bronze | 1 | 신규/저신뢰 |
| Silver | 5 | 중간 |
| Gold | 10 | 신뢰 |
| Diamond | 25+ | 최고 신뢰 |

- 에스크로 PDA: `[deployer, token_mint, "escrow"]`
- 24시간 안전 기간 경과 후 배포자가 담보 회수 가능
- 러그 발생 시 담보는 구매자에게 비례 분배

### 평판 점수 (Reputation Score)

0~100점 스케일. 등급: A(80+), B(60+), C(40+), D(20+), F(<20)

**계산:**
- 기본 50점
- 러그풀 이력 없음: +20
- 성공적 런칭 당: +10 (최대 +30)
- 러그풀 당: -20
- Gold 이상 담보: +10
- 계정 30일 이상: +5

### 본딩 커브

pump.fun 호환 선형 커브:

```
가격 = BASE_PRICE (0.0001 SOL) + SLOPE (0.00000001) x 현재공급량
졸업 조건: 시가총액 $69,000 도달 시 Raydium LP 이전
프로토콜 수수료: 0.5% / 거래 수수료: 1%
```

### 자동 환불 시스템

조건 (전부 충족 시):
1. 토큰 생성 후 24시간 이내
2. 구매자가 양(+) 잔고 보유
3. 이미 청구한 환불 없음

환불액 = 보유량 x 평균 매수가 (프로라타 배분)

### $FYRST 토큰 티어

| 티어 | 필요 수량 | 주요 혜택 |
|------|----------|----------|
| Free | 0 | 기본 브라우징, 공개 평판 조회 |
| Basic | 100 | 런칭 알림, 기본 분석 |
| Pro | 1,000 | 고급 분석, 환불 우선 처리, 배포자 딥다이브 |
| Elite | 10,000 | 고래 추적, 커스텀 알림, 거버넌스 투표 |
| Whale | 100,000 | 전체 혜택 + 비공개 감사 + 팀 직통 채널 |

---

## API 엔드포인트

| 메서드 | 경로 | 설명 |
|--------|------|------|
| GET | `/health` | 서비스 상태 확인 |
| GET | `/api/launches` | 전체 토큰 런칭 리스트 |
| GET | `/api/launches/:mint` | 토큰 상세 (민트 주소) |
| POST | `/api/launches` | 새 토큰 배포 (담보 필수) |
| GET | `/api/deployer/:address` | 배포자 프로필 + 런칭 이력 |
| GET | `/api/deployer/:address/score` | 평판 점수 상세 |
| POST | `/api/trade` | 토큰 매수/매도 (본딩 커브) |
| GET | `/api/portfolio/:wallet` | 지갑 보유 토큰 |
| GET | `/api/portfolio/:wallet/refunds` | 지갑 환불 이력 |
| GET | `/api/refunds/:wallet` | 환불 목록 |
| GET | `/api/refunds/:wallet/eligibility` | 환불 자격 확인 (?tokenMint=) |
| POST | `/api/refunds/:wallet/claim` | 환불 청구 (body: tokenMint) |

**WebSocket 이벤트 (Socket.io):**

| 이벤트 | 방향 | 설명 |
|--------|------|------|
| `subscribe:token` | Client -> Server | 토큰 가격 피드 구독 |
| `unsubscribe:token` | Client -> Server | 구독 해제 |
| `launch:new` | Server -> Client | 새 토큰 런칭 알림 |
| `trade:executed` | Server -> Client | 거래 체결 알림 |
| `price:update` | Server -> Client | 실시간 가격/공급량 업데이트 |

---

## 데이터베이스 테이블 (Prisma)

| 테이블 | 역할 | 주요 필드 |
|--------|------|----------|
| `Deployer` | 배포자 프로필 | address, reputationScore, rank, rugPulls, collateralTier |
| `Token` | 토큰 정보 | mint, name, symbol, marketCap, bondingCurveProgress, graduated |
| `Trade` | 거래 기록 | tokenMint, side(buy/sell), amount, price, txSignature |
| `Refund` | 환불 기록 | tokenMint, claimantAddress, amountSol, status, txSignature |
| `BuyerRecord` | 구매자 추적 | buyerAddress, tokenMint, totalBought, totalSold, avgPrice |

---

## 온체인 프로그램 (Anchor)

**Program ID:** `CcyByKGzRDK17icyNGAgdUN4q7WzbL1BPi4BNzqytyMP`

**빌드 상태:** 컴파일 완료 (fyrst.so 302KB, Agave v2.2.12)

**배포 상태:** 로컬 밸리데이터 배포 + IDL 검증 완료. Devnet 배포는 SOL 에어드롭 후 가능.

**IDL 검증 결과 (7개 인스트럭션 + 3개 어카운트):**
- Instructions: buy_tokens, create_escrow, init_bonding_curve, process_refund, record_buyer, release_escrow, sell_tokens
- Accounts: BondingCurve, BuyerRecord, EscrowVault

**인스트럭션:**
1. `create_escrow` -- 담보 잠금, PDA 볼트 생성
2. `release_escrow` -- 24시간 후 담보 회수
3. `init_bonding_curve` -- 본딩 커브 초기화
4. `buy_tokens` -- 토큰 매수
5. `sell_tokens` -- 토큰 매도
6. `record_buyer` -- 구매자 기록 (환불용)
7. `process_refund` -- 에스크로 -> 구매자 분배

---

## 프론트엔드 페이지 구성

| 경로 | 설명 |
|------|------|
| `/` | 랜딩 (Hero + 3D금고 + 통계 + HowItWorks + LiveLaunches + WhyFyrst) |
| `/launch` | 토큰 배포 폼 (이름, 심볼, 이미지, 담보 입력) |
| `/dashboard` | 전체 런칭 브라우징 (검색, 정렬: 최신/시총/평판) |
| `/token/[mint]` | 토큰 상세 (본딩 커브 차트, 매수/매도, 배포자 카드) |
| `/deployer/[address]` | 배포자 프로필 (평판, 런칭 이력, 러그 횟수) |

---

## 읽어야 할 산출물

### 프로젝트 문서 (루트)

| 파일 | 내용 |
|------|------|
| `_DIRECTION.md` | 프로젝트 방향성, 핵심 컨셉, 기술 결정사항, 절대 변경 금지 사항 |
| `_ARCHITECTURE.md` | 시스템 아키텍처, 디렉토리 구조, 데이터 흐름 |
| `_CHARACTER.md` | Sentry 마스코트, 컬러 시스템, 톤앤매너, 디자인 레퍼런스 |
| `FULL_CONCEPT_FYRST.md` | 프로젝트 전체 컨셉 문서 |
| `todo.md` | 전체 Phase 진행 상황 체크리스트 |

### 마케팅 산출물

| 파일 | 내용 |
|------|------|
| `산출물/마케팅/marketing-copy-en.md` | 영문 마케팅 카피 (트위터 바이오, pump.fun 설명, 10개 런칭 쓰레드, 5개 독립 트윗, 커뮤니티 공지) |
| `산출물/마케팅/marketing-copy-kr.md` | 한글 마케팅 카피 (동일 구조, 한국 크립토 커뮤니티 타겟) |

### 운영 가이드

| 파일 | 내용 |
|------|------|
| `산출물/운영가이드.md` | 런칭 전 체크리스트, D-Day 런북, 일상 운영, 핵심 지표, 스케일링, 비상 대응, SNS 일정 |
| `산출물/마케팅/운영가이드.md` | (동일 내용 복사본) |

### 이미지 에셋

| 파일 | 용도 |
|------|------|
| `산출물/이미지/logo*.png` | 로고 (5개 변형) |
| `산출물/이미지/twitter-profile*.png` | 트위터 프로필 (4개 변형) |
| `산출물/이미지/twitter-banner*.png` | 트위터 배너 (4개 변형) |
| `산출물/이미지/github-banner*.png` | GitHub 리포 배너 (4개 변형) |
| `산출물/이미지/community-banner*.png` | 커뮤니티/텔레그램 배너 (4개 변형) |
| `산출물/이미지/article-banner*.png` | 블로그/미디엄 헤더 (4개 변형) |
| `web/public/favicon.ico` | 파비콘 |
| `web/public/og-image.png` | 소셜 공유 OG 이미지 (1200x630) |

---

## CI/CD 파이프라인

`.github/workflows/ci.yml`:
- **트리거:** main 브랜치 push + PR
- **프론트엔드:** Node 22 -> npm ci -> tsc --noEmit -> next build
- **백엔드:** Node 22 -> npm ci -> tsc --noEmit -> tsc build

**자동 배포:**
- GitHub push -> Vercel 자동 빌드 (루트 디렉토리: `web/`)
- GitHub push -> Railway 자동 빌드 (서비스: `service/`, Nixpacks Node 22)

---

## 보안 헤더 (Vercel)

`web/vercel.json`에 설정됨:
- `X-Frame-Options: DENY` -- 클릭재킹 방지
- `X-Content-Type-Options: nosniff` -- MIME 스니핑 차단
- `Referrer-Policy: strict-origin-when-cross-origin`
- API 경로: `Cache-Control: no-store`

---

## 즉시 확인 필요

1. **api.fyrst.fun SSL:** Railway에서 SSL 인증서 발급 진행 중. 수 분 내 자동 완료 예정. 안 되면 Railway 대시보드에서 커스텀 도메인 삭제 후 다시 추가.
2. **Vercel 빌드 확인:** https://fyrst.fun 접속하여 랜딩 페이지 정상 렌더링 확인.

## 2차 후킹 전 해야 할 것

1. **Solana devnet 배포:** `solana airdrop 3 --url devnet` 후 `anchor deploy --provider.cluster devnet` (에어드롭 쿨다운 후 재시도, 약 2.15 SOL 필요)
2. **Vercel 환경변수 전환:** FEATURE_TRADING=true, FEATURE_REFUND=true로 변경 후 재배포
3. **텔레그램 봇 테스트:** 알림 수신 확인
4. **트위터/텔레그램 채널 개설:** 마케팅 카피는 준비 완료 (`산출물/마케팅/`)

---

## 기술 스택 요약

```
프론트엔드:  Next.js 15.5.12 / Tailwind v4 / zustand / Three.js / Solana Wallet Adapter
백엔드:     Express / TypeScript / Prisma 5 / Socket.io / BullMQ
DB:         PostgreSQL + Redis (Railway 호스팅)
온체인:     Anchor (Rust) / SPL Token / Solana
외부 API:   Helius DAS / Jupiter Price / QuickNode RPC / Telegram Bot
배포:       Vercel (프론트) + Railway (백엔드+DB+Redis)
CI/CD:      GitHub Actions
도메인:     fyrst.fun (Hostinger)
```
